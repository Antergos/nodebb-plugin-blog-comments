(function(){"use strict";function a(){try{return f=new XMLHttpRequest}catch(e){try{return f=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return f=new ActiveXObject("Msxml2.XMLHTTP")}}}function h(e){n=i.value;c=window.open(nodeBBURL+"/"+e,"_blank","toolbar=no, scrollbars=no, resizable=no, width=600, height=600");var t=setInterval(function(){if(c.closed){clearInterval(t);l=0;d()}},500)}function p(e){return e.replace(/href="\/(?=\w)/g,'href="'+nodeBBURL+"/").replace(/src="\/(?=\w)/g,'src="'+nodeBBURL+"/")}function d(){f.open("GET",nodeBBURL+"/comments/get/"+articleID+"/"+l,true);f.withCredentials=true;f.send()}function v(e){var t=[[60,"seconds",1],[120,"1 minute ago"],[3600,"minutes",60],[7200,"1 hour ago"],[86400,"hours",3600],[172800,"yesterday"],[604800,"days",86400],[1209600,"last week"],[2419200,"weeks",604800],[4838400,"last month"],[29030400,"months",2419200],[58060800,"last year"],[290304e4,"years",29030400]];var n=(+(new Date)-e)/1e3;if(n<10){return"just now"}var r=0,i;while(i=t[r++]){if(n<i[0]){if(!i[2]){return i[1]}else{return Math.floor(n/i[2])+" "+i[1]+" ago"}}}return e}function g(e,t){function n(e,t,n){var r=new RegExp("{"+e+"}","g");return n.replace(r,t)}function r(e){return new RegExp("<!--[\\s]*BEGIN "+e+"[\\s]*-->[\\s\\S]*<!--[\\s]*END "+e+"[\\s]*-->","g")}function i(e){return new RegExp("<!--[\\s]*IF "+e+"[\\s]*-->([\\s\\S]*?)<!--[\\s]*ENDIF "+e+"[\\s]*-->","g")}function s(e,t,n){s=n.match(e);if(s==null)return;if(t!==undefined)m.blocks[t]=s[0];var r=new RegExp("(\r\n)*<!-- BEGIN "+t+" -->(\r\n)*","g"),i=new RegExp("(\r\n)*<!-- END "+t+" -->(\r\n)*","g"),s=s[0].replace(r,"").replace(i,"");return s}function o(e,t,n){return n.replace(e,t)}var u,a;return function f(e,t,u,a){function l(e,t){var n=i(e),r=u.match(n);if(r!==null){for(var s=0,o=r.length;s<o;s++){var a=r[s].split(/<!-- ELSE -->/);var f=new RegExp("(<!--[\\s]*IF "+e+"[\\s]*-->)|(<!--[\\s]*ENDIF "+e+"[\\s]*-->)","gi");if(a[1]){if(!t){u=u.replace(r[s],a[1].replace(f,""))}else{u=u.replace(r[s],a[0].replace(f,""))}}else{if(!t){u=u.replace(r[s],"")}else{u=u.replace(r[s],r[s].replace(f,""))}}}}}if(!e||e.length==0){u=""}for(var c in e){if(e.hasOwnProperty(c)){if(typeof e[c]==="undefined"){continue}else if(e[c]===null){u=n(t+c,"",u)}else if(e[c].constructor==Array){l(t+c+".length",e[c].length);l("!"+t+c+".length",!e[c].length);t+=c+".";var h=r(c),p=s(h,t.substring(0,t.length-1),u);if(p==null){t=t.replace(c+".","");continue}var d=e[c].length-1,v=0,m="";do{m+=f(e[c][v],t,p,{iterator:v,total:d})}while(v++<d);t=t.replace(c+".","");u=o(h,m,u)}else if(e[c]instanceof Object){u=f(e[c],c+".",u)}else{var g=t+c,y=typeof e[c]==="string"?e[c].replace(/^\s+|\s+$/g,""):e[c];l(g,y);l("!"+g,!y);if(a&&a.iterator){l("@first",a.iterator===0);l("!@first",a.iterator!==0);l("@last",a.iterator===a.total);l("!@last",a.iterator!==a.total)}u=n(g,y,u)}}}if(t){var h=new RegExp("{"+t+"[\\s\\S]*?}","g");u=u.replace(h,"");t=""}else{u=u.replace(/<!-- ELSE -->/gi,"ENDIF -->").replace(/<!-- IF([^@]*?)ENDIF([^@]*?)-->/gi,"")}return u}(e,"",t)}var e=window.location.protocol+"//"+window.location.hostname+window.location.pathname;var t=nodeBBURL+"/plugins/nodebb-plugin-blog-comments",n,r,i,s,o;var u=document.createElement("link");u.setAttribute("rel","stylesheet");u.setAttribute("type","text/css");u.setAttribute("href",t+"/css/comments.css");document.getElementsByTagName("head")[0].appendChild(u);document.getElementById("nodebb/comments").insertAdjacentHTML("beforebegin",'<div id="nodebb"></div>');r=document.getElementById("nodebb");var f=a(),l=0,c;f.onload=function(){if(f.status>=200&&f.status<400){var t=JSON.parse(f.responseText),u;i=document.getElementById("nodebb-content");s=document.getElementById("nodebb-comments-list");o=document.getElementById("nodebb-comments-count");for(var c in t.posts){if(t.posts.hasOwnProperty(c)){t.posts[c].timestamp=v(parseInt(t.posts[c].timestamp),10);if(parseInt(t.posts[c].index,10)===parseInt(t.postCount,10)-1){delete t.posts[c]}}}if(o){o.innerHTML=t.postCount}t.relative_path=nodeBBURL;t.redirect_url=e;t.article_id=articleID;t.pagination=l;if(l){u=p(g(t,m.blocks["posts"]));s.innerHTML=s.innerHTML+u}else{u=g(t,t.template);r.innerHTML=p(u)}setTimeout(function(){var e=r.getElementsByTagName("li");for(var t in e){if(e.hasOwnProperty(t)){e[t].className=""}}},100);if(n){i.value=n}if(t.tid){var y=document.getElementById("nodebb-load-more");y.onclick=function(){l++;d()};if(t.posts.length){y.style.display="inline-block"}if(l*10+t.posts.length+1>=t.postCount){y.style.display="none"}if($&&$().fitVids){$(r).fitVids()}if(t.user&&t.user.uid){var b=window.location.href.match(/error=[\w-]*/);if(b){b=b[0].split("=")[1];if(b==="too-many-posts"){b="Please wait before posting so soon."}else if(b==="content-too-short"){b="Please post a longer reply."}document.getElementById("nodebb-error").innerHTML=b}}else{document.getElementById("nodebb-register").onclick=function(){h("register")};document.getElementById("nodebb-login").onclick=function(){h("login")}}}else{if(t.isAdmin){var w=a();w.open("GET","/ghost/api/v0.1/posts/"+articleID);w.onload=function(){if(w.status>=200&&w.status<400){var e=JSON.parse(w.responseText);document.getElementById("nodebb-content-markdown").value=e.markdown;document.getElementById("nodebb-content-title").value=e.title}else{r.innerHTML="Welcome "+t.user.username+', <a href="/ghost">sign in to Ghost</a> to enable the publish button.</a>'}};w.send()}}}};d();var m={blocks:{}}})()